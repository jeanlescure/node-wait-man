{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","lib/wait-man.js","wait-man.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","$$waitman$$WaitMan","options","extend","target","extender_obj","k","no_done","this","WaiterCollection","onSuccess","uid","successful_waiter","self","pending_waiters","filter","w","successful_waiters","push","waiter_not_pending","tick","check_timeout","abort","aborted","timeoutfn","setTimeout","onDone","interval","resetWaiterLists","waiters","aborted_waiters","kill_timeoutfn","clearTimeout","defaults","timeout","beganAt","endedAt","elapsed","Date","begin","Waiter","test","pending","successful","replace","c","Math","random","v","toString","success_callback","define","amd","window","WaitMan"],"mappings":"CAAA,QAAAA,GAAAC,EAAAC,EAAAC,GAAA,QAAAC,GAAAC,EAAAC,GAAA,IAAAJ,EAAAG,GAAA,CAAA,IAAAJ,EAAAI,GAAA,CAAA,GAAAE,GAAA,kBAAAC,UAAAA,OAAA,KAAAF,GAAAC,EAAA,MAAAA,GAAAF,GAAA,EAAA,IAAAI,EAAA,MAAAA,GAAAJ,GAAA,EAAA,IAAAK,GAAA,GAAAC,OAAA,uBAAAN,EAAA,IAAA,MAAAK,GAAAE,KAAA,mBAAAF,EAAA,GAAAG,GAAAX,EAAAG,IAAAS,WAAAb,GAAAI,GAAA,GAAAU,KAAAF,EAAAC,QAAA,SAAAd,GAAA,GAAAE,GAAAD,EAAAI,GAAA,GAAAL,EAAA,OAAAI,GAAAF,EAAAA,EAAAF,IAAAa,EAAAA,EAAAC,QAAAd,EAAAC,EAAAC,EAAAC,GAAA,MAAAD,GAAAG,GAAAS,QAAA,IAAA,GAAAL,GAAA,kBAAAD,UAAAA,QAAAH,EAAA,EAAAA,EAAAF,EAAAa,OAAAX,IAAAD,EAAAD,EAAAE,GAAA,OAAAD,KAAAa,GAAA,SAAAT,EAAAU,EAAAJ,ICAA,WACE,QAASK,GAAmBC,GAC1B,QAASC,GAAOC,EAAQC,GACtB,IAAKC,IAAKD,GACRD,EAAOE,GAAKD,EAAaC,GAM7B,QAASC,KAAW,KAAM,0BAF1BC,KAAKL,OAASA,EAIdK,KAAKC,iBAAmB,SAASP,GAqB/B,QAASQ,GAAUC,GACjB,GAAIC,GAAoBC,EAAKC,gBAAgBC,OAAO,SAASC,GAC3D,MAAOA,GAAEL,MAAQA,IAChB,EAEHE,GAAKI,mBAAmBC,KAAKN,GAE7BO,EAAmBR,GAGrB,QAASQ,GAAmBR,GAC1BE,EAAKC,gBAAkBD,EAAKC,gBAAgBC,OAAO,SAASC,GAC1D,MAAOA,GAAEL,MAAQA,IAarB,QAASS,KACHP,EAAKQ,iBAAiBR,EAAKS,QAE1BT,EAAKU,UAASV,EAAKW,UAAYC,WAAW,WACzCZ,EAAKQ,iBAAiBR,EAAKS,QAEK,IAAhCT,EAAKC,gBAAgBhB,QAAiBe,EAAKU,QAG7CH,IAFAP,EAAKa,UAINb,EAAKc,WAGV,QAASC,KACPf,EAAKC,gBAAkBD,EAAKgB,QAAQd,OAAO,WAAW,OAAO,IAC7DF,EAAKI,sBACLJ,EAAKiB,mBAmBP,QAASC,KACuB,mBAAnBlB,GAAKW,WAA2BQ,aAAanB,EAAKW,WAlF/D,GAAIX,GAAOL,IAEXA,MAAKyB,UACHJ,WACAf,mBACAG,sBACAa,mBACAJ,OAAQnB,EACRoB,SAAU,IACVO,QAAS,EACTC,QAAS,EACTC,QAAS,EACTb,SAAS,GAGXf,KAAKN,QAAUA,EAEfC,EAAOK,KAAMA,KAAKyB,UACU,mBAAjBzB,MAAKN,SAAyBC,EAAOK,KAAMA,KAAKN,SAkB3DM,KAAK6B,QAAU,WACb,GAAIA,GAAW7B,KAAKM,gBAAgBhB,OAAS,GAAM,GAAIwC,MAAS9B,KAAK2B,QAAU3B,KAAK4B,QAAU5B,KAAK2B,OACnG,OAAOE,IAGT7B,KAAKa,cAAgB,WACnB,MAAQb,MAAK6B,UAAY7B,KAAK0B,SAAW1B,KAAK0B,QAAU,GAuB1D1B,KAAK+B,MAAQ,WACX,GAAI1B,EAAKgB,QAAQ/B,OAAS,EAAG,KAAM,iBAEnCe,GAAKsB,SAAW,GAAIG,MACpBzB,EAAKuB,QAAU,EAEfR,IACAf,EAAKU,SAAU,CAEf,KAAK,GAAIhC,KAAKsB,GAAKC,gBACjBD,EAAKC,gBAAgBvB,GAAGgD,MAAM7B,EAGhCU,MAOFZ,KAAKc,MAAQ,WACX,GAAIT,EAAKC,gBAAgBhB,OAAS,EAAE,CAClCiC,IAEAlB,EAAKU,SAAU,CAEf,KAAK,GAAIhC,KAAKsB,GAAKC,gBACjBD,EAAKC,gBAAgB,GAAGQ,QAExBT,EAAKiB,gBAAgBZ,KAAKL,EAAKC,gBAAgB,IAE/CK,EAAmBN,EAAKC,gBAAgB,GAAGH,IAI7CE,GAAKuB,SAAW,GAAIE,MAEpBzB,EAAKa,YAKXlB,KAAKgC,OAAS,SAAStC,GA8DrB,QAAS6B,KACuB,mBAAnBlB,GAAKW,WAA2BQ,aAAanB,EAAKW,WA9D/D,GAAIX,GAAOL,IAEXA,MAAKyB,UACHQ,KAAM,WAAY,KAAM,wCACxBd,SAAU,IACVO,QAAS,EACTC,QAAS,EACTC,QAAS,EACTM,SAAS,EACTC,YAAY,EACZpB,SAAS,GAGXf,KAAKN,QAAUA,EAEfC,EAAOK,KAAMA,KAAKyB,UACU,mBAAjBzB,MAAKN,SAAyBC,EAAOK,KAAMA,KAAKN,SAE3DM,KAAK6B,QAAU,WACb,GAAIA,GAAW7B,KAAY,SAAK,GAAI8B,MAAS9B,KAAK2B,QAAU3B,KAAK4B,QAAU5B,KAAK2B,OAChF,OAAOE,IAGT7B,KAAKa,cAAgB,WACnB,MAAQb,MAAK6B,UAAY7B,KAAK0B,SAAW1B,KAAK0B,QAAU,GAG1D1B,KAAKG,IAAM,uCAAuCiC,QAAQ,QAAS,SAASC,GAAI,GAAI5D,GAAkB,GAAd6D,KAAKC,SAAY,EAAEC,EAAK,KAAHH,EAAO5D,EAAI,EAAFA,EAAM,CAAI,OAAO+D,GAAEC,SAAS,MAClJzC,KAAKY,KAAO,SAAS8B,GAGnB,GAFAnB,IAEgC,mBAArBmB,GAAkC,KAAM,kDAE/CrC,GAAKQ,iBAAiBR,EAAKS,QAE1BT,EAAKU,UAASV,EAAKW,UAAYC,WAAW,WACzCZ,EAAKQ,iBAAiBR,EAAKS,QAE3BT,EAAK4B,SAAW5B,EAAKU,SACvBV,EAAK6B,SAAU,EACf7B,EAAK8B,YAAa,EAClB9B,EAAKuB,SAAW,GAAIE,MACpBY,EAAiBrC,EAAKF,MACbE,EAAKU,SACdV,EAAKO,KAAK8B,IAEXrC,EAAKc,YAGVnB,KAAK+B,MAAQ,SAASW,GACpBnB,IAEAlB,EAAK6B,SAAU,EACf7B,EAAK8B,YAAa,EAClB9B,EAAKU,SAAU,EACfV,EAAKsB,SAAW,GAAIG,MACpBzB,EAAKuB,QAAU,EAEfvB,EAAKO,KAAK8B,IAOZ1C,KAAKc,MAAQ,WACPT,EAAK6B,UACPX,IACAlB,EAAK6B,SAAU,EACf7B,EAAKU,SAAU,EACfV,EAAKuB,SAAW,GAAIE,SAMN,mBAAXtC,IAAoD,mBAAnBA,GAAOJ,QACjDI,EAAOJ,QAAUK,EACQ,kBAAXkD,SAAyBA,OAAOC,IAC9CD,UAAW,WACT,MAAOlD,KAGToD,OAAOC,QAAUrD,eCKV","file":"wait-man.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function(){\r\n  function $$waitman$$WaitMan(options){\r\n    function extend(target, extender_obj){\r\n      for (k in extender_obj){\r\n        target[k] = extender_obj[k];\r\n      }\r\n    }\r\n    \r\n    this.extend = extend; // For Spec's sake.\r\n    \r\n    function no_done(){ throw \"No done callback found!\"; };\r\n    \r\n    this.WaiterCollection = function(options){\r\n      var self = this;\r\n      \r\n      this.defaults = {\r\n        waiters: [],\r\n        pending_waiters: [],\r\n        successful_waiters: [],\r\n        aborted_waiters: [],\r\n        onDone: no_done,\r\n        interval: 100,\r\n        timeout: 0,\r\n        beganAt: 0,\r\n        endedAt: 0,\r\n        aborted: false\r\n      };\r\n      \r\n      this.options = options;\r\n      \r\n      extend(this, this.defaults);\r\n      if (typeof this.options !== 'undefined') extend(this, this.options);\r\n      \r\n      function onSuccess(uid){\r\n        var successful_waiter = self.pending_waiters.filter(function(w){\r\n          return w.uid === uid;\r\n        })[0];\r\n        \r\n        self.successful_waiters.push(successful_waiter);\r\n        \r\n        waiter_not_pending(uid);\r\n      }\r\n      \r\n      function waiter_not_pending(uid){\r\n        self.pending_waiters = self.pending_waiters.filter(function(w){\r\n          return w.uid !== uid;\r\n        });\r\n      }\r\n      \r\n      this.elapsed = function(){\r\n        var elapsed = (this.pending_waiters.length > 0) ? +new Date() - this.beganAt : this.endedAt - this.beganAt;\r\n        return elapsed;\r\n      };\r\n      \r\n      this.check_timeout = function(){\r\n        return (this.elapsed() > this.timeout && this.timeout > 0);\r\n      };\r\n      \r\n      function tick(){\r\n        if (self.check_timeout()) self.abort();\r\n        \r\n        if (!self.aborted) self.timeoutfn = setTimeout(function(){\r\n          if (self.check_timeout()) self.abort();\r\n          \r\n          if (self.pending_waiters.length === 0 && !self.aborted){\r\n            self.onDone();\r\n          }else{\r\n            tick();\r\n          }\r\n        }, self.interval);\r\n      }\r\n      \r\n      function resetWaiterLists(){\r\n        self.pending_waiters = self.waiters.filter(function(){return true;});\r\n        self.successful_waiters = [];\r\n        self.aborted_waiters = [];\r\n      }\r\n      \r\n      this.begin = function(){\r\n        if (self.waiters.length < 1) throw \"No waiters set!\";\r\n        \r\n        self.beganAt = +new Date();\r\n        self.endedAt = 0;\r\n        \r\n        resetWaiterLists();\r\n        self.aborted = false;\r\n        \r\n        for (var i in self.pending_waiters){\r\n          self.pending_waiters[i].begin(onSuccess);\r\n        }\r\n        \r\n        tick();\r\n      }\r\n      \r\n      function kill_timeoutfn(){\r\n        if (typeof self.timeoutfn !== 'undefined') clearTimeout(self.timeoutfn);\r\n      }\r\n      \r\n      this.abort = function(){\r\n        if (self.pending_waiters.length > 0){\r\n          kill_timeoutfn();\r\n          \r\n          self.aborted = true;\n          \r\n          for (var i in self.pending_waiters){\r\n            self.pending_waiters[0].abort();\r\n            \r\n            self.aborted_waiters.push(self.pending_waiters[0]);\r\n            \r\n            waiter_not_pending(self.pending_waiters[0].uid);\r\n          }\r\n          \r\n          \r\n          self.endedAt = +new Date();\r\n          \r\n          self.onDone();\r\n        }\r\n      }\r\n    };\r\n    \r\n    this.Waiter = function(options){\r\n      var self = this;\r\n      \r\n      this.defaults = {\r\n        test: function(){ throw \"No test function for waiter defined!\"; },\r\n        interval: 100,\r\n        timeout: 0,\r\n        beganAt: 0,\r\n        endedAt: 0,\r\n        pending: false,\r\n        successful: false,\r\n        aborted: false\r\n      };\r\n      \r\n      this.options = options;\r\n      \r\n      extend(this, this.defaults);\r\n      if (typeof this.options !== 'undefined') extend(this, this.options);\r\n      \r\n      this.elapsed = function(){\r\n        var elapsed = (this.pending) ? +new Date() - this.beganAt : this.endedAt - this.beganAt;\r\n        return elapsed;\r\n      };\r\n      \r\n      this.check_timeout = function(){\r\n        return (this.elapsed() > this.timeout && this.timeout > 0);\r\n      };\r\n      \r\n      this.uid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {var r = Math.random()*16|0,v=c=='x'?r:r&0x3|0x8;return v.toString(16);});\r\n      this.tick = function(success_callback){\r\n        kill_timeoutfn();\r\n        \r\n        if (typeof success_callback === 'undefined') throw \"No success callback function defined for waiter!\";\n        \n        if (self.check_timeout()) self.abort();\r\n        \r\n        if (!self.aborted) self.timeoutfn = setTimeout(function(){\r\n          if (self.check_timeout()) self.abort();\r\n          \r\n          if (self.test() && !self.aborted){\r\n            self.pending = false;\r\n            self.successful = true;\r\n            self.endedAt = +new Date();\r\n            success_callback(self.uid);\r\n          }else if (!self.aborted){\r\n            self.tick(success_callback);\r\n          }\r\n        }, self.interval);\r\n      };\r\n      \r\n      this.begin = function(success_callback){\r\n        kill_timeoutfn();\n        \r\n        self.pending = true;\r\n        self.successful = false;\r\n        self.aborted = false;\r\n        self.beganAt = +new Date();\r\n        self.endedAt = 0;\r\n        \r\n        self.tick(success_callback);\r\n      };\r\n      \r\n      function kill_timeoutfn(){\r\n        if (typeof self.timeoutfn !== 'undefined') clearTimeout(self.timeoutfn);\r\n      }\r\n      \r\n      this.abort = function(){\r\n        if (self.pending){\r\n          kill_timeoutfn();\r\n          self.pending = false;\r\n          self.aborted = true;\r\n          self.endedAt = +new Date();\r\n        }\r\n      };\r\n    };\r\n  };\r\n  \r\n  if (typeof module !== 'undefined' && typeof module.exports !== 'undefined'){\r\n    module.exports = $$waitman$$WaitMan;\r\n  }else if(typeof define === 'function' && define.amd){\r\n    define([], function() {\r\n      return $$waitman$$WaitMan;\r\n    });\r\n  }else{\r\n    window.WaitMan = $$waitman$$WaitMan;\r\n  }\r\n})();",null],"sourceRoot":"/source/"}